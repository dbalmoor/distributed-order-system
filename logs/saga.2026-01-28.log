Starting InventoryServiceApplication using Java 17.0.12 with PID 32364 (F:\PROJECTS\git\distributed-order-system\inventory-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Starting InventoryServiceApplication using Java 17.0.12 with PID 45896 (F:\PROJECTS\git\distributed-order-system\inventory-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started InventoryServiceApplication in 5.006 seconds (process running for 5.414)
Starting InventoryServiceApplication using Java 17.0.12 with PID 14184 (F:\PROJECTS\git\distributed-order-system\inventory-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started InventoryServiceApplication in 5.808 seconds (process running for 6.253)
Starting OrderServiceApplication using Java 17.0.12 with PID 15880 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 5.237 seconds (process running for 5.624)
Order event sent: {"orderId":20,"orderNumber":"ORD-58eb5cf6","userId":123,"totalAmount":60000,"items":[{"productId":2,"quantity":50,"price":1200}],"createdAt":"2026-01-28T20:43:05.0176553"}
[SAGA] [ORDER] [ORDER:ORD-58eb5cf6] [ORDER_CREATED] [SUCCESS] at 2026-01-28T20:43:05.388651600
Received order: ORD-58eb5cf6
[SAGA] [INVENTORY] [ORDER:ORD-58eb5cf6] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T20:43:05.704532500
[SAGA] [INVENTORY] [ORDER:ORD-58eb5cf6] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T20:43:05.704532500
[SAGA] [INVENTORY] [ORDER:ORD-58eb5cf6] [FOUND_PRODUCT_2] [SUCCESS] at 2026-01-28T20:43:06.755747900
[SAGA] [INVENTORY] [ORDER:ORD-58eb5cf6] [INSUFFICIENT_STOCK_PRODUCT_2] [FAILED] at 2026-01-28T20:43:06.755747900
Inventory failed event sent: {"orderId":20,"orderNumber":"ORD-58eb5cf6","reason":"Insufficient stock"}
[SAGA] [INVENTORY] [ORDER:ORD-58eb5cf6] [EVENT_PUBLISHED_FAILED] [FAILED] at 2026-01-28T20:43:06.840754
Inventory FAILED for order ORD-58eb5cf6 : Insufficient stock
Order event sent: {"orderId":21,"orderNumber":"ORD-de0e09c5","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T20:43:35.6392304"}
[SAGA] [ORDER] [ORDER:ORD-de0e09c5] [ORDER_CREATED] [SUCCESS] at 2026-01-28T20:43:35.646576700
Received order: ORD-de0e09c5
[SAGA] [INVENTORY] [ORDER:ORD-de0e09c5] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T20:43:35.661936800
[SAGA] [INVENTORY] [ORDER:ORD-de0e09c5] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T20:43:35.662480600
[SAGA] [INVENTORY] [ORDER:ORD-de0e09c5] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T20:43:35.666922
[SAGA] [INVENTORY] [ORDER:ORD-de0e09c5] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T20:43:35.772636400
Inventory reserved event sent: {"orderNumber":"ORD-de0e09c5","orderId":21,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-de0e09c5] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T20:43:35.790410600
Received inventory.reserved: {"orderNumber":"ORD-de0e09c5","orderId":21,"amount":1200}
Failed to process inventory.reserved
com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field "amount" (class com.deepana.orderservice.events.InventoryReservedEvent), not marked as ignorable (2 known properties: "orderId", "orderNumber"])
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 57] (through reference chain: com.deepana.orderservice.events.InventoryReservedEvent["amount"])
	at com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException.from(UnrecognizedPropertyException.java:61)
	at com.fasterxml.jackson.databind.DeserializationContext.handleUnknownProperty(DeserializationContext.java:1208)
	at com.fasterxml.jackson.databind.deser.std.StdDeserializer.handleUnknownProperty(StdDeserializer.java:2380)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownProperty(BeanDeserializerBase.java:1823)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownVanilla(BeanDeserializerBase.java:1801)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:308)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:169)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:5038)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3954)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3922)
	at com.deepana.orderservice.kafka.listener.InventoryEventListener.handleInventoryReserved(InventoryEventListener.java:36)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
Order event sent: {"orderId":22,"orderNumber":"ORD-a065bf7d","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T20:49:06.2958672"}
[SAGA] [ORDER] [ORDER:ORD-a065bf7d] [ORDER_CREATED] [SUCCESS] at 2026-01-28T20:49:06.302908400
Received order: ORD-a065bf7d
[SAGA] [INVENTORY] [ORDER:ORD-a065bf7d] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T20:49:06.322371
[SAGA] [INVENTORY] [ORDER:ORD-a065bf7d] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T20:49:06.322912700
[SAGA] [INVENTORY] [ORDER:ORD-a065bf7d] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T20:49:06.328175200
[SAGA] [INVENTORY] [ORDER:ORD-a065bf7d] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T20:49:06.334993600
Inventory reserved event sent: {"orderNumber":"ORD-a065bf7d","orderId":22,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-a065bf7d] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T20:49:06.336091900
Received inventory.reserved: {"orderNumber":"ORD-a065bf7d","orderId":22,"amount":1200}
Failed to process inventory.reserved
com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field "amount" (class com.deepana.orderservice.events.InventoryReservedEvent), not marked as ignorable (2 known properties: "orderId", "orderNumber"])
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 57] (through reference chain: com.deepana.orderservice.events.InventoryReservedEvent["amount"])
	at com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException.from(UnrecognizedPropertyException.java:61)
	at com.fasterxml.jackson.databind.DeserializationContext.handleUnknownProperty(DeserializationContext.java:1208)
	at com.fasterxml.jackson.databind.deser.std.StdDeserializer.handleUnknownProperty(StdDeserializer.java:2380)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownProperty(BeanDeserializerBase.java:1823)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownVanilla(BeanDeserializerBase.java:1801)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:308)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:169)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:5038)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3954)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3922)
	at com.deepana.orderservice.kafka.listener.InventoryEventListener.handleInventoryReserved(InventoryEventListener.java:36)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
Starting OrderServiceApplication using Java 17.0.12 with PID 26284 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 6.663 seconds (process running for 7.157)
Starting OrderServiceApplication using Java 17.0.12 with PID 10184 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 6.926 seconds (process running for 7.426)
Order event sent: {"orderId":23,"orderNumber":"ORD-a3a70e3d","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:27:09.0380834"}
[SAGA] [ORDER] [ORDER:ORD-a3a70e3d] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:27:09.306623
Received order: ORD-a3a70e3d
[SAGA] [INVENTORY] [ORDER:ORD-a3a70e3d] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:27:09.363972500
[SAGA] [INVENTORY] [ORDER:ORD-a3a70e3d] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:27:09.363972500
[SAGA] [INVENTORY] [ORDER:ORD-a3a70e3d] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:27:09.385873700
[SAGA] [INVENTORY] [ORDER:ORD-a3a70e3d] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:27:09.400692300
Inventory reserved event sent: {"orderNumber":"ORD-a3a70e3d","orderId":23,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-a3a70e3d] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:27:09.407353500
Received payment.success {"orderId":23,"orderNumber":"ORD-a3a70e3d"}
[SAGA] [ORDER] [ORDER:ORD-a3a70e3d] [PAYMENT_SUCCESS] [SUCCESS] at 2026-01-28T21:27:09.609462600
Order ORD-a3a70e3d COMPLETED
Failed to process payment.success
org.springframework.dao.DataIntegrityViolationException: could not execute statement [ERROR: new row for relation "orders" violates check constraint "orders_status_check"
  Detail: Failing row contains (23, 2026-01-28 21:27:09.038083, DELIVERY, ORD-a3a70e3d, ONLINE, COMPLETED, 1200.00, 2026-01-28 21:27:09.612903, 123, 1).] [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?]; SQL [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?]; constraint [orders_status_check]
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.convertHibernateAccessException(HibernateExceptionTranslator.java:169)
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.convertHibernateAccessException(HibernateExceptionTranslator.java:131)
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.translateExceptionIfPossible(HibernateExceptionTranslator.java:105)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:199)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:557)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:794)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:757)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:687)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:408)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:130)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:719)
	at com.deepana.orderservice.service.OrderServiceImpl$$SpringCGLIB$$0.handlePaymentSuccess(<generated>)
	at com.deepana.orderservice.kafka.PaymentEventConsumer.handleSuccess(PaymentEventConsumer.java:31)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.hibernate.exception.ConstraintViolationException: could not execute statement [ERROR: new row for relation "orders" violates check constraint "orders_status_check"
  Detail: Failing row contains (23, 2026-01-28 21:27:09.038083, DELIVERY, ORD-a3a70e3d, ONLINE, COMPLETED, 1200.00, 2026-01-28 21:27:09.612903, 123, 1).] [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?]
	at org.hibernate.exception.internal.SQLStateConversionDelegate.convert(SQLStateConversionDelegate.java:73)
	at org.hibernate.exception.internal.StandardSQLExceptionConverter.convert(StandardSQLExceptionConverter.java:34)
	at org.hibernate.engine.jdbc.spi.SqlExceptionHelper.convert(SqlExceptionHelper.java:115)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:184)
	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.performNonBatchedMutation(AbstractMutationExecutor.java:145)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorSingleNonBatched.performNonBatchedOperations(MutationExecutorSingleNonBatched.java:53)
	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.execute(AbstractMutationExecutor.java:66)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.doStaticUpdate(UpdateCoordinatorStandard.java:776)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.performUpdate(UpdateCoordinatorStandard.java:313)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.update(UpdateCoordinatorStandard.java:231)
	at org.hibernate.action.internal.EntityUpdateAction.execute(EntityUpdateAction.java:161)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:634)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:505)
	at org.hibernate.event.internal.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:381)
	at org.hibernate.event.internal.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:40)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireFlush(SessionImpl.java:1489)
	at org.hibernate.internal.SessionImpl.managedFlush(SessionImpl.java:481)
	at org.hibernate.internal.SessionImpl.flushBeforeTransactionCompletion(SessionImpl.java:2116)
	at org.hibernate.internal.SessionImpl.beforeTransactionCompletion(SessionImpl.java:2038)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.beforeTransactionCompletion(JdbcCoordinatorImpl.java:410)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.beforeCompletionCallback(JdbcResourceLocalTransactionCoordinatorImpl.java:166)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commitNoRollbackOnly(JdbcResourceLocalTransactionCoordinatorImpl.java:248)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:242)
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:89)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:553)
	... 32 common frames omitted
Caused by: org.postgresql.util.PSQLException: ERROR: new row for relation "orders" violates check constraint "orders_status_check"
  Detail: Failing row contains (23, 2026-01-28 21:27:09.038083, DELIVERY, ORD-a3a70e3d, ONLINE, COMPLETED, 1200.00, 2026-01-28 21:27:09.612903, 123, 1).
	at org.postgresql.core.v3.QueryExecutorImpl.receiveErrorResponse(QueryExecutorImpl.java:2846)
	at org.postgresql.core.v3.QueryExecutorImpl.processResults(QueryExecutorImpl.java:2531)
	at org.postgresql.core.v3.QueryExecutorImpl.execute(QueryExecutorImpl.java:429)
	at org.postgresql.jdbc.PgStatement.executeInternal(PgStatement.java:526)
	at org.postgresql.jdbc.PgStatement.execute(PgStatement.java:436)
	at org.postgresql.jdbc.PgPreparedStatement.executeWithFlags(PgPreparedStatement.java:196)
	at org.postgresql.jdbc.PgPreparedStatement.executeUpdate(PgPreparedStatement.java:157)
	at com.zaxxer.hikari.pool.ProxyPreparedStatement.executeUpdate(ProxyPreparedStatement.java:61)
	at com.zaxxer.hikari.pool.HikariProxyPreparedStatement.executeUpdate(HikariProxyPreparedStatement.java)
	at org.hibernate.engine.jdbc.internal.ResultSetReturnImpl.executeUpdate(ResultSetReturnImpl.java:181)
	... 54 common frames omitted
Starting OrderServiceApplication using Java 17.0.12 with PID 37868 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 3.474 seconds (process running for 3.714)
Order event sent: {"orderId":24,"orderNumber":"ORD-9313b492","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:36:30.2495261"}
[SAGA] [ORDER] [ORDER:ORD-9313b492] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:36:30.473930100
Starting InventoryServiceApplication using Java 17.0.12 with PID 29604 (F:\PROJECTS\git\distributed-order-system\inventory-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started InventoryServiceApplication in 3.287 seconds (process running for 3.522)
Received order: ORD-9313b492
[SAGA] [INVENTORY] [ORDER:ORD-9313b492] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:36:48.838110200
[SAGA] [INVENTORY] [ORDER:ORD-9313b492] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:36:48.838110200
[SAGA] [INVENTORY] [ORDER:ORD-9313b492] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:36:49.113968900
[SAGA] [INVENTORY] [ORDER:ORD-9313b492] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:36:49.146664400
Inventory reserved event sent: {"orderNumber":"ORD-9313b492","orderId":24,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-9313b492] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:36:49.190404400
Received inventory.reserved: {"orderNumber":"ORD-9313b492","orderId":24,"amount":1200}
Failed to process inventory.reserved
com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field "amount" (class com.deepana.orderservice.events.InventoryReservedEvent), not marked as ignorable (2 known properties: "orderId", "orderNumber"])
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 57] (through reference chain: com.deepana.orderservice.events.InventoryReservedEvent["amount"])
	at com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException.from(UnrecognizedPropertyException.java:61)
	at com.fasterxml.jackson.databind.DeserializationContext.handleUnknownProperty(DeserializationContext.java:1208)
	at com.fasterxml.jackson.databind.deser.std.StdDeserializer.handleUnknownProperty(StdDeserializer.java:2380)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownProperty(BeanDeserializerBase.java:1823)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownVanilla(BeanDeserializerBase.java:1801)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:308)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:169)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:5038)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3954)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3922)
	at com.deepana.orderservice.kafka.listener.InventoryEventListener.handleInventoryReserved(InventoryEventListener.java:36)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
Received payment.success {"orderId":24,"orderNumber":"ORD-9313b492"}
[SAGA] [ORDER] [ORDER:ORD-9313b492] [PAYMENT_SUCCESS] [SUCCESS] at 2026-01-28T21:38:10.361095800
Order ORD-9313b492 COMPLETED
Order event sent: {"orderId":25,"orderNumber":"ORD-70ddb88a","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:38:41.3180729"}
[SAGA] [ORDER] [ORDER:ORD-70ddb88a] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:38:41.321102300
Received order: ORD-70ddb88a
[SAGA] [INVENTORY] [ORDER:ORD-70ddb88a] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:38:41.347538500
[SAGA] [INVENTORY] [ORDER:ORD-70ddb88a] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:38:41.347538500
[SAGA] [INVENTORY] [ORDER:ORD-70ddb88a] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:38:41.351788600
[SAGA] [INVENTORY] [ORDER:ORD-70ddb88a] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:38:41.355618700
Inventory reserved event sent: {"orderNumber":"ORD-70ddb88a","orderId":25,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-70ddb88a] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:38:41.356784800
Received payment.success {"orderId":25,"orderNumber":"ORD-70ddb88a"}
[SAGA] [ORDER] [ORDER:ORD-70ddb88a] [PAYMENT_SUCCESS] [SUCCESS] at 2026-01-28T21:38:41.406036700
Order ORD-70ddb88a COMPLETED
Starting OrderServiceApplication using Java 17.0.12 with PID 33812 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 3.399 seconds (process running for 3.623)
Order event sent: {"orderId":26,"orderNumber":"ORD-937513dc","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:43:06.0935204"}
[SAGA] [ORDER] [ORDER:ORD-937513dc] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:43:06.378789200
Received order: ORD-937513dc
[SAGA] [INVENTORY] [ORDER:ORD-937513dc] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:43:06.454834600
[SAGA] [INVENTORY] [ORDER:ORD-937513dc] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:43:06.454834600
[SAGA] [INVENTORY] [ORDER:ORD-937513dc] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:43:06.460459300
[SAGA] [INVENTORY] [ORDER:ORD-937513dc] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:43:06.466266900
Inventory reserved event sent: {"orderNumber":"ORD-937513dc","orderId":26,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-937513dc] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:43:06.467295300
Received inventory.reserved: {"orderNumber":"ORD-937513dc","orderId":26,"amount":1200}
Received payment.failed {"orderId":26,"orderNumber":"ORD-937513dc","reason":"Payment gateway declined"}
Failed to process inventory.reserved
com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException: Unrecognized field "amount" (class com.deepana.orderservice.events.InventoryReservedEvent), not marked as ignorable (2 known properties: "orderId", "orderNumber"])
 at [Source: REDACTED (`StreamReadFeature.INCLUDE_SOURCE_IN_LOCATION` disabled); line: 1, column: 57] (through reference chain: com.deepana.orderservice.events.InventoryReservedEvent["amount"])
	at com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException.from(UnrecognizedPropertyException.java:61)
	at com.fasterxml.jackson.databind.DeserializationContext.handleUnknownProperty(DeserializationContext.java:1208)
	at com.fasterxml.jackson.databind.deser.std.StdDeserializer.handleUnknownProperty(StdDeserializer.java:2380)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownProperty(BeanDeserializerBase.java:1823)
	at com.fasterxml.jackson.databind.deser.BeanDeserializerBase.handleUnknownVanilla(BeanDeserializerBase.java:1801)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.vanillaDeserialize(BeanDeserializer.java:308)
	at com.fasterxml.jackson.databind.deser.BeanDeserializer.deserialize(BeanDeserializer.java:169)
	at com.fasterxml.jackson.databind.deser.DefaultDeserializationContext.readRootValue(DefaultDeserializationContext.java:342)
	at com.fasterxml.jackson.databind.ObjectMapper._readMapAndClose(ObjectMapper.java:5038)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3954)
	at com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3922)
	at com.deepana.orderservice.kafka.listener.InventoryEventListener.handleInventoryReserved(InventoryEventListener.java:36)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
[SAGA] [ORDER] [ORDER:ORD-937513dc] [PAYMENT_FAILED] [FAILED] at 2026-01-28T21:43:06.665298500
Payment failed for order ORD-937513dc : Payment gateway declined
Starting OrderServiceApplication using Java 17.0.12 with PID 29344 (F:\PROJECTS\git\distributed-order-system\order-service\target\classes started by deepa in F:\PROJECTS\git\distributed-order-system)
No active profile set, falling back to 1 default profile: "default"
Started OrderServiceApplication in 4.57 seconds (process running for 4.798)
Order event sent: {"orderId":27,"orderNumber":"ORD-014ef297","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:45:22.3091619"}
[SAGA] [ORDER] [ORDER:ORD-014ef297] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:45:22.590058600
Received order: ORD-014ef297
[SAGA] [INVENTORY] [ORDER:ORD-014ef297] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:45:22.633591200
[SAGA] [INVENTORY] [ORDER:ORD-014ef297] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:45:22.633591200
[SAGA] [INVENTORY] [ORDER:ORD-014ef297] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:45:22.637682300
[SAGA] [INVENTORY] [ORDER:ORD-014ef297] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:45:22.646130500
Inventory reserved event sent: {"orderNumber":"ORD-014ef297","orderId":27,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-014ef297] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:45:22.647128200
Received inventory.reserved: {"orderNumber":"ORD-014ef297","orderId":27,"amount":1200}
Received payment.success {"orderId":27,"orderNumber":"ORD-014ef297"}
[SAGA] [ORDER] [ORDER:ORD-014ef297] [PAYMENT_SUCCESS] [SUCCESS] at 2026-01-28T21:45:22.794688800
Order ORD-014ef297 COMPLETED
Failed to process inventory.reserved
org.springframework.orm.ObjectOptimisticLockingFailureException: Unexpected row count (expected row count 1 but was 0) [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?] for entity [com.deepana.orderservice.entity.Order with id '27']
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.convertHibernateAccessException(HibernateExceptionTranslator.java:204)
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.convertHibernateAccessException(HibernateExceptionTranslator.java:131)
	at org.springframework.orm.jpa.hibernate.HibernateExceptionTranslator.translateExceptionIfPossible(HibernateExceptionTranslator.java:109)
	at org.springframework.orm.jpa.vendor.HibernateJpaDialect.translateExceptionIfPossible(HibernateJpaDialect.java:199)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:557)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.processCommit(AbstractPlatformTransactionManager.java:794)
	at org.springframework.transaction.support.AbstractPlatformTransactionManager.commit(AbstractPlatformTransactionManager.java:757)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.commitTransactionAfterReturning(TransactionAspectSupport.java:687)
	at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:408)
	at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:130)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:135)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.data.jpa.repository.support.CrudMethodMetadataPostProcessor$CrudMethodMetadataPopulatingMethodInterceptor.invoke(CrudMethodMetadataPostProcessor.java:166)
	at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:179)
	at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:222)
	at jdk.proxy2/jdk.proxy2.$Proxy160.save(Unknown Source)
	at com.deepana.orderservice.kafka.listener.InventoryEventListener.handleInventoryReserved(InventoryEventListener.java:46)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
	at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)
	at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
	at java.base/java.lang.reflect.Method.invoke(Method.java:568)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:168)
	at org.springframework.kafka.listener.adapter.KotlinAwareInvocableHandlerMethod.doInvoke(KotlinAwareInvocableHandlerMethod.java:48)
	at org.springframework.messaging.handler.invocation.InvocableHandlerMethod.invoke(InvocableHandlerMethod.java:119)
	at org.springframework.kafka.listener.adapter.HandlerAdapter.invoke(HandlerAdapter.java:80)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invokeHandler(MessagingMessageListenerAdapter.java:488)
	at org.springframework.kafka.listener.adapter.MessagingMessageListenerAdapter.invoke(MessagingMessageListenerAdapter.java:425)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:92)
	at org.springframework.kafka.listener.adapter.RecordMessagingMessageListenerAdapter.onMessage(RecordMessagingMessageListenerAdapter.java:52)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeOnMessage(KafkaMessageListenerContainer.java:2901)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeOnMessage(KafkaMessageListenerContainer.java:2880)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeRecordListener(KafkaMessageListenerContainer.java:2790)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.doInvokeWithRecords(KafkaMessageListenerContainer.java:2632)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeRecordListener(KafkaMessageListenerContainer.java:2526)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeListener(KafkaMessageListenerContainer.java:2164)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.invokeIfHaveRecords(KafkaMessageListenerContainer.java:1541)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.pollAndInvoke(KafkaMessageListenerContainer.java:1479)
	at org.springframework.kafka.listener.KafkaMessageListenerContainer$ListenerConsumer.run(KafkaMessageListenerContainer.java:1348)
	at java.base/java.util.concurrent.CompletableFuture$AsyncRun.run(CompletableFuture.java:1804)
	at java.base/java.lang.Thread.run(Thread.java:842)
Caused by: org.hibernate.StaleObjectStateException: Unexpected row count (expected row count 1 but was 0) [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?] for entity [com.deepana.orderservice.entity.Order with id '27']
	at org.hibernate.engine.jdbc.mutation.internal.ModelMutationHelper.identifiedResultsCheck(ModelMutationHelper.java:73)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.resultCheck(UpdateCoordinatorStandard.java:1025)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.lambda$doStaticUpdate$1(UpdateCoordinatorStandard.java:781)
	at org.hibernate.engine.jdbc.mutation.internal.ModelMutationHelper.checkResults(ModelMutationHelper.java:48)
	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.performNonBatchedMutation(AbstractMutationExecutor.java:152)
	at org.hibernate.engine.jdbc.mutation.internal.MutationExecutorSingleNonBatched.performNonBatchedOperations(MutationExecutorSingleNonBatched.java:53)
	at org.hibernate.engine.jdbc.mutation.internal.AbstractMutationExecutor.execute(AbstractMutationExecutor.java:66)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.doStaticUpdate(UpdateCoordinatorStandard.java:776)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.performUpdate(UpdateCoordinatorStandard.java:313)
	at org.hibernate.persister.entity.mutation.UpdateCoordinatorStandard.update(UpdateCoordinatorStandard.java:231)
	at org.hibernate.action.internal.EntityUpdateAction.execute(EntityUpdateAction.java:161)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:634)
	at org.hibernate.engine.spi.ActionQueue.executeActions(ActionQueue.java:505)
	at org.hibernate.event.internal.AbstractFlushingEventListener.performExecutions(AbstractFlushingEventListener.java:381)
	at org.hibernate.event.internal.DefaultFlushEventListener.onFlush(DefaultFlushEventListener.java:40)
	at org.hibernate.event.service.internal.EventListenerGroupImpl.fireEventOnEachListener(EventListenerGroupImpl.java:138)
	at org.hibernate.internal.SessionImpl.fireFlush(SessionImpl.java:1489)
	at org.hibernate.internal.SessionImpl.managedFlush(SessionImpl.java:481)
	at org.hibernate.internal.SessionImpl.flushBeforeTransactionCompletion(SessionImpl.java:2116)
	at org.hibernate.internal.SessionImpl.beforeTransactionCompletion(SessionImpl.java:2038)
	at org.hibernate.engine.jdbc.internal.JdbcCoordinatorImpl.beforeTransactionCompletion(JdbcCoordinatorImpl.java:410)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl.beforeCompletionCallback(JdbcResourceLocalTransactionCoordinatorImpl.java:166)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commitNoRollbackOnly(JdbcResourceLocalTransactionCoordinatorImpl.java:248)
	at org.hibernate.resource.transaction.backend.jdbc.internal.JdbcResourceLocalTransactionCoordinatorImpl$TransactionDriverControlImpl.commit(JdbcResourceLocalTransactionCoordinatorImpl.java:242)
	at org.hibernate.engine.transaction.internal.TransactionImpl.commit(TransactionImpl.java:89)
	at org.springframework.orm.jpa.JpaTransactionManager.doCommit(JpaTransactionManager.java:553)
	... 36 common frames omitted
Caused by: org.hibernate.StaleStateException: Unexpected row count (expected row count 1 but was 0) [update orders set created_at=?,fulfillment_type=?,order_number=?,payment_type=?,status=?,total_amount=?,updated_at=?,user_id=?,version=? where id=? and version=?]
	at org.hibernate.jdbc.Expectations.checkNonBatched(Expectations.java:93)
	at org.hibernate.jdbc.Expectation$RowCount.verifyOutcome(Expectation.java:170)
	at org.hibernate.engine.jdbc.mutation.internal.ModelMutationHelper.identifiedResultsCheck(ModelMutationHelper.java:60)
	... 61 common frames omitted
Order event sent: {"orderId":28,"orderNumber":"ORD-57e77fe4","userId":123,"totalAmount":1200,"items":[{"productId":1,"quantity":1,"price":1200}],"createdAt":"2026-01-28T21:47:27.2771015"}
[SAGA] [ORDER] [ORDER:ORD-57e77fe4] [ORDER_CREATED] [SUCCESS] at 2026-01-28T21:47:27.284117600
Received order: ORD-57e77fe4
[SAGA] [INVENTORY] [ORDER:ORD-57e77fe4] [RECEIVED_ORDER] [SUCCESS] at 2026-01-28T21:47:27.297926400
[SAGA] [INVENTORY] [ORDER:ORD-57e77fe4] [CHECKING_STOCK] [SUCCESS] at 2026-01-28T21:47:27.297926400
[SAGA] [INVENTORY] [ORDER:ORD-57e77fe4] [FOUND_PRODUCT_1] [SUCCESS] at 2026-01-28T21:47:27.301434500
[SAGA] [INVENTORY] [ORDER:ORD-57e77fe4] [RESERVED_PRODUCT_1] [SUCCESS] at 2026-01-28T21:47:27.306885800
Inventory reserved event sent: {"orderNumber":"ORD-57e77fe4","orderId":28,"amount":1200}
[SAGA] [INVENTORY] [ORDER:ORD-57e77fe4] [EVENT_PUBLISHED] [SUCCESS] at 2026-01-28T21:47:27.308257
Received inventory.reserved: {"orderNumber":"ORD-57e77fe4","orderId":28,"amount":1200}
Order ORD-57e77fe4 CONFIRMED
[SAGA] [ORDER] [ORDER:ORD-57e77fe4] [INVENTORY_RESERVED] [SUCCESS] at 2026-01-28T21:47:27.342113600
Received payment.success {"orderId":28,"orderNumber":"ORD-57e77fe4"}
[SAGA] [ORDER] [ORDER:ORD-57e77fe4] [PAYMENT_SUCCESS] [SUCCESS] at 2026-01-28T21:47:27.358985100
Order ORD-57e77fe4 COMPLETED
